version: '3.7'

services:
    gateway:
        build: services/graphql-server
        depends_on:
            - registry
        ports:
            - '8000:80'
        environment:
            PORT: 80
            LOG_LEVEL: DEBUG
            REGISTRY_URL: registry

    registry:
        build:
            context: services/registry
            args:
                target: DEBUG

        depends_on:
            - k8s-fs-resources
        environment:
            LOG_LEVEL: INFO
            PORT: 80
            GRPC_PORT: 81

            REMOTESOURCE__KUBERNETES_FS: http://k8s-fs-resources

    k8s-fs-resources:
        build: remote-sources/kubernetes-fs
        environment:
            PORT: 80
            RESOURCE_FOLDER: /resources
        volumes:
            - ./remote-sources/kubernetes-fs/resources:/resources

    # Mock services
    customer-api:
        container_name: customer-api
        build: e2e/mocks/customer-api
        environment:
            PORT: 80

    hotel-api:
        container_name: hotel-api
        build: e2e/mocks/hotel-api
        environment:
            PORT: 80

    order-api:
        container_name: order-api
        build: e2e/mocks/order-api
        environment:
            PORT: 80
